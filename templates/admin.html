<!DOCTYPE html>
<html lang="en" class="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel - TempMail</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üõ°Ô∏è</text></svg>">
<style>
body {
font-family: 'Inter', sans-serif;
background: linear-gradient(135deg, #1e3a8a 0%, #7e22ce 100%);
min-height: 100vh;
}
.glass-effect {
background: rgba(255, 255, 255, 0.15);
backdrop-filter: blur(12px);
border: 1px solid rgba(255, 255, 255, 0.2);
}
.address-item {
transition: all 0.2s ease;
cursor: pointer;
}
.address-item:hover {
background: rgba(255, 255, 255, 0.2);
transform: translateY(-1px);
}
.fade-in {
animation: fadeIn 0.5s ease-in;
}
@keyframes fadeIn {
from { opacity: 0; transform: translateY(10px); }
to { opacity: 1; transform: translateY(0); }
}
#login-screen {
display: flex;
justify-content: center;
align-items: center;
min-height: 100vh;
}
.login-box {
background: rgba(255, 255, 255, 0.15);
backdrop-filter: blur(12px);
border: 1px solid rgba(255, 255, 255, 0.2);
padding: 40px;
border-radius: 20px;
text-align: center;
max-width: 400px;
width: 100%;
}
.login-box input {
width: 100%;
padding: 15px;
margin-bottom: 20px;
background: rgba(0, 0, 0, 0.3);
border: 2px solid rgba(255, 255, 255, 0.2);
border-radius: 10px;
color: white;
font-size: 16px;
}
.login-box input::placeholder {
color: rgba(255, 255, 255, 0.5);
}
.login-box button {
width: 100%;
padding: 15px;
background: linear-gradient(135deg, #a855f7, #ec4899);
border: none;
border-radius: 10px;
color: white;
font-size: 16px;
font-weight: bold;
cursor: pointer;
}
.error {
color: #fca5a5;
margin-top: 10px;
font-size: 14px;
}
</style>
</head>
<body class="text-gray-100 min-h-screen p-4">

<!-- LOGIN SCREEN -->
<div id="login-screen">
<div class="login-box">
<i class="fas fa-shield-alt text-5xl text-white mb-4"></i>
<h1 class="text-3xl font-bold text-white mb-2">Admin Panel</h1>
<p class="text-gray-300 mb-6">Enter password to access</p>
<input type="password" id="admin-password" placeholder="Enter admin password" />
<button id="admin-login-btn">Login</button>
<p id="admin-login-error" class="error" style="display:none;">‚ùå Invalid password</p>
</div>
</div>

<!-- ADMIN DASHBOARD (Hidden until logged in) -->
<div id="admin-dashboard" style="display:none;">
<div class="w-full max-w-7xl mx-auto fade-in">
<header class="text-center mb-8">
<div class="flex items-center justify-between mb-4">
<div class="flex items-center">
<i class="fas fa-shield-alt text-3xl text-white mr-3"></i>
<h1 class="text-4xl font-bold text-white">Admin Panel</h1>
</div>
<div class="flex gap-2">
<a href="https://tempmail.aungmyomyatzaw.online" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-all">
<i class="fas fa-home mr-2"></i>Main Site
</a>
<button id="logout-btn" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-all">
<i class="fas fa-sign-out-alt mr-2"></i>Logout
</button>
</div>
</div>
<p class="text-gray-300">Monitor and manage all temporary email addresses</p>
</header>

<!-- Stats Cards -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
<div class="glass-effect rounded-xl p-6 fade-in">
<div class="flex items-center justify-between">
<div>
<p class="text-gray-300 text-sm">Total Emails</p>
<p id="stat-emails" class="text-3xl font-bold text-white">0</p>
</div>
<i class="fas fa-envelope text-4xl text-blue-400"></i>
</div>
</div>
<div class="glass-effect rounded-xl p-6 fade-in">
<div class="flex items-center justify-between">
<div>
<p class="text-gray-300 text-sm">Email Addresses</p>
<p id="stat-addresses" class="text-3xl font-bold text-white">0</p>
</div>
<i class="fas fa-users text-4xl text-green-400"></i>
</div>
</div>
<div class="glass-effect rounded-xl p-6 fade-in">
<div class="flex items-center justify-between">
<div>
<p class="text-gray-300 text-sm">Last 24 Hours</p>
<p id="stat-recent" class="text-3xl font-bold text-white">0</p>
</div>
<i class="fas fa-clock text-4xl text-purple-400"></i>
</div>
</div>
</div>

<!-- Main Content -->
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<!-- Email Addresses List -->
<div class="glass-effect rounded-xl p-6 fade-in">
<div class="flex justify-between items-center mb-4">
<h2 class="text-xl font-bold text-white">
<i class="fas fa-list mr-2"></i>Email Addresses
</h2>
<button onclick="loadAddresses()" class="text-blue-400 hover:text-blue-300 transition-colors">
<i class="fas fa-sync-alt"></i> Refresh
</button>
</div>
<div id="address-list" class="space-y-2 max-h-96 overflow-y-auto">
<p class="text-gray-400 text-center py-8">Loading...</p>
</div>
</div>

<!-- Email Details -->
<div class="glass-effect rounded-xl p-6 fade-in">
<h2 class="text-xl font-bold text-white mb-4">
<i class="fas fa-envelope-open mr-2"></i>Emails for: <span id="selected-address" class="text-blue-400">None</span>
</h2>
<div id="email-details" class="space-y-2 max-h-96 overflow-y-auto">
<p class="text-gray-400 text-center py-8">Select an address to view emails</p>
</div>
</div>
</div>
</div>
</div>

<script>
var API_URL = window.location.origin;
var selectedAddress = null;

// Login handler
document.getElementById('admin-login-btn').addEventListener('click', adminLogin);
document.getElementById('admin-password').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') adminLogin();
});

function adminLogin() {
    var password = document.getElementById('admin-password').value;
    var errorEl = document.getElementById('admin-login-error');
    
    fetch(API_URL + '/api/admin/login', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({password: password})
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('admin-dashboard').style.display = 'block';
            loadStats();
            loadAddresses();
            startAutoRefresh();
        } else {
            errorEl.style.display = 'block';
            setTimeout(() => errorEl.style.display = 'none', 3000);
        }
    })
    .catch(err => {
        alert('Connection error. Please try again.');
    });
}

// Logout handler
document.getElementById('logout-btn').addEventListener('click', function() {
    fetch(API_URL + '/api/admin/logout', {method: 'POST'})
    .then(() => {
        location.reload();
    });
});

// Load stats
function loadStats() {
    fetch(API_URL + '/api/admin/stats')
    .then(res => {
        if (res.status === 401) {
            location.reload();
            return;
        }
        return res.json();
    })
    .then(data => {
        if (data) {
            document.getElementById('stat-emails').textContent = data.total_emails;
            document.getElementById('stat-addresses').textContent = data.total_addresses;
            document.getElementById('stat-recent').textContent = data.recent_emails;
        }
    })
    .catch(err => console.error('Error loading stats:', err));
}

// Load addresses
function loadAddresses() {
    fetch(API_URL + '/api/admin/addresses')
    .then(res => {
        if (res.status === 401) {
            location.reload();
            return;
        }
        return res.json();
    })
    .then(data => {
        if (!data) return;
        
        var list = document.getElementById('address-list');
        list.innerHTML = '';
        
        if (data.addresses.length === 0) {
            list.innerHTML = '<p class="text-gray-400 text-center py-8">No addresses yet</p>';
            return;
        }
        
        data.addresses.forEach(addr => {
            var item = document.createElement('div');
            item.className = 'address-item bg-gray-800 p-4 rounded-lg border border-gray-700';
            item.innerHTML = `
                <div class="flex justify-between items-center">
                    <div class="flex-1">
                        <p class="text-white font-semibold truncate">${escapeHtml(addr.address)}</p>
                        <p class="text-xs text-gray-400">${addr.count} email${addr.count > 1 ? 's' : ''} ‚Ä¢ ${formatTime(addr.last_email)}</p>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="viewEmails('${escapeHtml(addr.address)}')" class="text-blue-400 hover:text-blue-300 p-2 rounded" title="View emails">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button onclick="deleteAddress('${escapeHtml(addr.address)}')" class="text-red-400 hover:text-red-300 p-2 rounded" title="Delete all">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `;
            list.appendChild(item);
        });
    })
    .catch(err => console.error('Error loading addresses:', err));
}

// View emails for address
function viewEmails(address) {
    selectedAddress = address;
    document.getElementById('selected-address').textContent = address;
    
    fetch(API_URL + '/api/admin/emails/' + encodeURIComponent(address))
    .then(res => res.json())
    .then(data => {
        var details = document.getElementById('email-details');
        details.innerHTML = '';
        
        if (data.emails.length === 0) {
            details.innerHTML = '<p class="text-gray-400 text-center py-8">No emails</p>';
            return;
        }
        
        data.emails.forEach(email => {
            var item = document.createElement('div');
            item.className = 'bg-gray-800 p-4 rounded-lg border border-gray-700 mb-2';
            
            var displayBody = email.body.replace(/<[^>]*>/g, '').substring(0, 100);
            
            item.innerHTML = `
                <div class="flex justify-between items-start mb-2">
                    <div class="flex-1">
                        <p class="text-white font-semibold text-sm">${escapeHtml(email.sender)}</p>
                        <p class="text-gray-300 text-sm">${escapeHtml(email.subject)}</p>
                        <p class="text-xs text-gray-400 mt-1">${formatTime(email.timestamp)}</p>
                    </div>
                    <button onclick="deleteEmail(${email.id})" class="text-red-400 hover:text-red-300 p-2 rounded" title="Delete">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
                <p class="text-xs text-gray-400 truncate">${escapeHtml(displayBody)}...</p>
            `;
            details.appendChild(item);
        });
    })
    .catch(err => console.error('Error loading emails:', err));
}

// Delete single email
function deleteEmail(emailId) {
    if (!confirm('Delete this email?')) return;
    
    fetch(API_URL + '/api/admin/delete/' + emailId, {method: 'DELETE'})
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            viewEmails(selectedAddress);
            loadStats();
            showNotification('Email deleted successfully');
        }
    })
    .catch(err => console.error('Error deleting email:', err));
}

// Delete all emails for address
function deleteAddress(address) {
    if (!confirm('Delete ALL emails for ' + address + '?\n\nThis cannot be undone!')) return;
    
    fetch(API_URL + '/api/admin/delete-address/' + encodeURIComponent(address), {method: 'DELETE'})
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            loadAddresses();
            loadStats();
            document.getElementById('email-details').innerHTML = '<p class="text-gray-400 text-center py-8">Select an address to view emails</p>';
            document.getElementById('selected-address').textContent = 'None';
            showNotification('All emails deleted for ' + address);
        }
    })
    .catch(err => console.error('Error deleting address:', err));
}

function escapeHtml(text) {
    var div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

function formatTime(timestamp) {
    var date = new Date(timestamp);
    var now = new Date();
    var diff = now - date;
    var minutes = Math.floor(diff / 60000);
    
    if (minutes < 1) return 'just now';
    if (minutes < 60) return minutes + ' min ago';
    if (minutes < 1440) return Math.floor(minutes / 60) + 'h ago';
    return date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'});
}

function showNotification(message) {
    var notification = document.createElement('div');
    notification.className = 'fixed top-4 right-4 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg z-50 fade-in';
    notification.innerHTML = '<i class="fas fa-check-circle mr-2"></i>' + message;
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.remove();
    }, 3000);
}

function startAutoRefresh() {
    setInterval(() => {
        loadStats();
        loadAddresses();
        if (selectedAddress) viewEmails(selectedAddress);
    }, 30000);
}
</script>
</body>
</html>
