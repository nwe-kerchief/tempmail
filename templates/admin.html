<!DOCTYPE html>
<html lang="en" class="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel - TempMail</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ›¡ï¸</text></svg>">
<style>
body {
font-family: 'Inter', sans-serif;
background: linear-gradient(135deg, #1e3a8a 0%, #7e22ce 100%);
min-height: 100vh;
}
.glass-effect {
background: rgba(255, 255, 255, 0.15);
backdrop-filter: blur(12px);
border: 1px solid rgba(255, 255, 255, 0.2);
}
.address-item {
transition: all 0.2s ease;
cursor: pointer;
}
.address-item:hover {
background: rgba(255, 255, 255, 0.2);
transform: translateY(-1px);
}
.fade-in {
animation: fadeIn 0.5s ease-in;
}
@keyframes fadeIn {
from { opacity: 0; transform: translateY(10px); }
to { opacity: 1; transform: translateY(0); }
}
#login-screen {
display: flex;
justify-content: center;
align-items: center;
min-height: 100vh;
}
.login-box {
background: rgba(255, 255, 255, 0.15);
backdrop-filter: blur(12px);
border: 1px solid rgba(255, 255, 255, 0.2);
padding: 40px;
border-radius: 20px;
text-align: center;
max-width: 400px;
width: 100%;
}
.login-box input {
width: 100%;
padding: 15px;
margin-bottom: 20px;
background: rgba(0, 0, 0, 0.3);
border: 2px solid rgba(255, 255, 255, 0.2);
border-radius: 10px;
color: white;
font-size: 16px;
}
.login-box input::placeholder {
color: rgba(255, 255, 255, 0.5);
}
.login-box button {
width: 100%;
padding: 15px;
background: linear-gradient(135deg, #a855f7, #ec4899);
border: none;
border-radius: 10px;
color: white;
font-size: 16px;
font-weight: bold;
cursor: pointer;
transition: all 0.3s ease;
}
.login-box button:hover {
transform: translateY(-2px);
box-shadow: 0 4px 12px rgba(168, 85, 247, 0.4);
}
.error {
color: #fca5a5;
margin-top: 10px;
font-size: 14px;
}

/* Custom Modal */
.modal-overlay {
position: fixed;
top: 0;
left: 0;
right: 0;
bottom: 0;
background: rgba(0, 0, 0, 0.7);
display: flex;
align-items: center;
justify-content: center;
z-index: 1000;
backdrop-filter: blur(5px);
}
.modal-content {
background: linear-gradient(135deg, #1e293b 0%, #374151 100%);
border-radius: 16px;
padding: 2rem;
max-width: 400px;
width: 90%;
border: 1px solid rgba(255, 255, 255, 0.1);
box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5);
}
.modal-buttons {
display: flex;
gap: 12px;
margin-top: 1.5rem;
}
.modal-btn {
flex: 1;
padding: 12px 20px;
border-radius: 10px;
font-weight: 600;
transition: all 0.2s ease;
border: none;
cursor: pointer;
}
.modal-btn-confirm {
background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
color: white;
}
.modal-btn-confirm:hover {
transform: translateY(-2px);
box-shadow: 0 4px 12px rgba(220, 38, 38, 0.4);
}
.modal-btn-cancel {
background: rgba(255, 255, 255, 0.1);
color: white;
border: 1px solid rgba(255, 255, 255, 0.2);
}
.modal-btn-cancel:hover {
background: rgba(255, 255, 255, 0.2);
transform: translateY(-2px);
}

/* Scrollbar styling */
.custom-scrollbar::-webkit-scrollbar {
width: 6px;
}
.custom-scrollbar::-webkit-scrollbar-track {
background: rgba(255, 255, 255, 0.1);
border-radius: 3px;
}
.custom-scrollbar::-webkit-scrollbar-thumb {
background: rgba(255, 255, 255, 0.3);
border-radius: 3px;
}
.custom-scrollbar::-webkit-scrollbar-thumb:hover {
background: rgba(255, 255, 255, 0.5);
}
</style>
</head>
<body class="text-gray-100 min-h-screen p-4">

<!-- Custom Modal Structure -->
<div id="custom-modal" class="modal-overlay hidden">
<div class="modal-content">
<div class="text-center mb-4">
<i class="fas fa-exclamation-triangle text-3xl text-yellow-400 mb-3"></i>
<h3 class="text-xl font-bold text-white mb-2" id="modal-title">Confirm Action</h3>
<p class="text-gray-300" id="modal-message">Are you sure you want to proceed?</p>
</div>
<div class="modal-buttons">
<button id="modal-cancel" class="modal-btn modal-btn-cancel">Cancel</button>
<button id="modal-confirm" class="modal-btn modal-btn-confirm">Confirm</button>
</div>
</div>
</div>

<!-- LOGIN SCREEN -->
<div id="login-screen">
<div class="login-box">
<i class="fas fa-shield-alt text-5xl text-white mb-4"></i>
<h1 class="text-3xl font-bold text-white mb-2">Admin Panel</h1>
<p class="text-gray-300 mb-6">TempMail System Administration</p>
<input type="password" id="admin-password" placeholder="Enter admin password" />
<button id="admin-login-btn">
<i class="fas fa-sign-in-alt mr-2"></i>Login
</button>
<p id="admin-login-error" class="error" style="display:none;">âŒ Invalid password</p>
</div>
</div>

<!-- ADMIN DASHBOARD (Hidden until logged in) -->
<div id="admin-dashboard" style="display:none;">
    <div class="w-full max-w-7xl mx-auto fade-in">
        <header class="text-center mb-8">
            <div class="flex flex-col md:flex-row justify-between items-center mb-4 gap-4">
                <div class="flex items-center">
                    <i class="fas fa-shield-alt text-3xl text-white mr-3"></i>
                    <h1 class="text-4xl font-bold text-white">Admin Dashboard</h1>
                </div>
                <div class="flex gap-2">
                    <a href="/" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-all transform hover:scale-105">
                        <i class="fas fa-home mr-2"></i>Main Site
                    </a>
                    <button id="logout-btn" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-all transform hover:scale-105">
                        <i class="fas fa-sign-out-alt mr-2"></i>Logout
                    </button>
                </div>
            </div>
            <p class="text-gray-300">Monitor and manage all temporary email addresses</p>
        </header>

        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <div class="glass-effect rounded-xl p-6 fade-in">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-300 text-sm">Total Emails</p>
                        <p id="stat-emails" class="text-3xl font-bold text-white">0</p>
                    </div>
                    <i class="fas fa-envelope text-4xl text-blue-400"></i>
                </div>
            </div>
            <div class="glass-effect rounded-xl p-6 fade-in">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-300 text-sm">Email Addresses</p>
                        <p id="stat-addresses" class="text-3xl font-bold text-white">0</p>
                    </div>
                    <i class="fas fa-users text-4xl text-green-400"></i>
                </div>
            </div>
            <div class="glass-effect rounded-xl p-6 fade-in">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-300 text-sm">Last 24 Hours</p>
                        <p id="stat-recent" class="text-3xl font-bold text-white">0</p>
                    </div>
                    <i class="fas fa-clock text-4xl text-purple-400"></i>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <!-- Email Addresses List -->
            <div class="glass-effect rounded-xl p-6 fade-in">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-2">
                    <h2 class="text-xl font-bold text-white">
                        <i class="fas fa-list mr-2"></i>Email Addresses
                    </h2>
                    <button onclick="loadAddresses()" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg transition-all transform hover:scale-105">
                        <i class="fas fa-sync-alt mr-1"></i> Refresh
                    </button>
                </div>
                <div id="address-list" class="space-y-2 max-h-96 overflow-y-auto custom-scrollbar">
                    <p class="text-gray-400 text-center py-8">Loading addresses...</p>
                </div>
            </div>

            <!-- Email Details -->
            <div class="glass-effect rounded-xl p-6 fade-in">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-2">
                    <h2 class="text-xl font-bold text-white">
                        <i class="fas fa-envelope-open mr-2"></i>Emails for: 
                        <span id="selected-address" class="text-blue-400">None selected</span>
                    </h2>
                    <div id="email-count-badge" class="bg-blue-600 text-white px-3 py-1 rounded-full text-sm font-medium hidden">
                        0 emails
                    </div>
                </div>
                <div id="email-details" class="space-y-2 max-h-96 overflow-y-auto custom-scrollbar">
                    <p class="text-gray-400 text-center py-8">Select an address to view emails</p>
                </div>
            </div>
        </div>

        <!-- Active Sessions Section -->
        <div class="glass-effect rounded-xl p-6 fade-in mb-6">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-2">
                <h2 class="text-xl font-bold text-white">
                    <i class="fas fa-play-circle mr-2"></i>Active Sessions
                </h2>
                <button onclick="loadActiveSessions()" class="bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded-lg transition-all transform hover:scale-105">
                    <i class="fas fa-sync-alt mr-1"></i> Refresh
                </button>
            </div>
            <div id="active-sessions" class="space-y-2 max-h-64 overflow-y-auto custom-scrollbar">
                <p class="text-gray-400 text-center py-8">Loading active sessions...</p>
            </div>
        </div>

        <!-- Blacklist Management Section -->
        <div class="glass-effect rounded-xl p-6 fade-in">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-2">
                <h2 class="text-xl font-bold text-white">
                    <i class="fas fa-ban mr-2"></i>Blacklisted Usernames
                </h2>
                <div class="flex flex-col sm:flex-row gap-2 w-full sm:w-auto">
                    <input type="text" id="new-blacklist-username" placeholder="Enter username to blacklist" 
                           class="bg-gray-700 text-white px-3 py-2 rounded-lg border border-gray-600 focus:border-blue-500 focus:outline-none w-full sm:w-48">
                    <button onclick="addToBlacklist()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-all transform hover:scale-105 whitespace-nowrap">
                        <i class="fas fa-plus mr-1"></i> Add to Blacklist
                    </button>
                </div>
            </div>
            <div id="blacklist-list" class="space-y-2 max-h-64 overflow-y-auto custom-scrollbar">
                <p class="text-gray-400 text-center py-8">Loading blacklist...</p>
            </div>
        </div>
    </div>
</div>


<script>
var API_URL = window.location.origin;
var selectedAddress = null;
var autoRefreshInterval = null;
var DOMAIN = 'aungmyomyatzaw.online';

// Blacklist management functions
function loadBlacklist() {
    fetch(API_URL + '/api/admin/blacklist')
    .then(res => {
        if (res.status === 401) {
            location.reload();
            return;
        }
        return res.json();
    })
    .then(data => {
        var blacklistEl = document.getElementById('blacklist-list');
        
        if (!data || data.error) {
            blacklistEl.innerHTML = '<p class="text-red-400 text-center py-8">Error loading blacklist</p>';
            return;
        }
        
        if (!data.blacklist || data.blacklist.length === 0) {
            blacklistEl.innerHTML = '<p class="text-gray-400 text-center py-8">No blacklisted usernames</p>';
            return;
        }
        
        blacklistEl.innerHTML = '';
        
        data.blacklist.forEach(username => {
            var item = document.createElement('div');
            item.className = 'bg-gray-800 p-3 rounded-lg border border-gray-700 flex justify-between items-center';
            item.innerHTML = `
                <div>
                    <span class="text-white font-semibold">${escapeHtml(username)}</span>
                    <span class="text-xs text-gray-400 ml-2">@${DOMAIN}</span>
                </div>
                <button onclick="removeFromBlacklist('${escapeHtml(username)}')" class="text-green-400 hover:text-green-300 p-1 rounded transition-colors" title="Remove from blacklist">
                    <i class="fas fa-times"></i>
                </button>
            `;
            blacklistEl.appendChild(item);
        });
    })
    .catch(err => {
        console.error('Error loading blacklist:', err);
        document.getElementById('blacklist-list').innerHTML = '<p class="text-red-400 text-center py-8">Failed to load blacklist</p>';
    });
}

function addToBlacklist() {
    var usernameInput = document.getElementById('new-blacklist-username');
    var username = usernameInput.value.trim().toLowerCase();
    
    if (!username) {
        showNotification('âŒ Please enter a username', 'error');
        return;
    }
    
    if (!/^[a-zA-Z0-9-_]+$/.test(username)) {
        showNotification('âŒ Username can only contain letters, numbers, hyphens, and underscores', 'error');
        return;
    }
    
    showModal(
        'Add to Blacklist',
        `Are you sure you want to blacklist the username "<strong>${escapeHtml(username)}</strong>"?<br><br>This will prevent all users from using this username.`,
        function() {
            fetch(API_URL + '/api/admin/blacklist', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({username: username})
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    showNotification(`âœ… ${data.message}`, 'success');
                    usernameInput.value = '';
                    loadBlacklist();
                } else {
                    showNotification(`âŒ ${data.error || 'Failed to add to blacklist'}`, 'error');
                }
            })
            .catch(err => {
                console.error('Error adding to blacklist:', err);
                showNotification('âŒ Error adding to blacklist', 'error');
            });
        }
    );
}

function removeFromBlacklist(username) {
    showModal(
        'Remove from Blacklist',
        `Are you sure you want to remove "<strong>${escapeHtml(username)}</strong>" from the blacklist?<br><br>Users will be able to use this username again.`,
        function() {
            fetch(API_URL + '/api/admin/blacklist/' + encodeURIComponent(username), {
                method: 'DELETE'
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    showNotification(`âœ… ${data.message}`, 'success');
                    loadBlacklist();
                } else {
                    showNotification(`âŒ ${data.error || 'Failed to remove from blacklist'}`, 'error');
                }
            })
            .catch(err => {
                console.error('Error removing from blacklist:', err);
                showNotification('âŒ Error removing from blacklist', 'error');
            });
        }
    );
}
// Update the startAutoRefresh to include blacklist
function startAutoRefresh() {
Â  Â  if (autoRefreshInterval) clearInterval(autoRefreshInterval);
Â  Â  autoRefreshInterval = setInterval(() => {
Â  Â  Â  Â  loadStats();
Â  Â  Â  Â  loadAddresses();
Â  Â  Â  Â  loadActiveSessions();
Â  Â  Â  Â  loadBlacklist();
Â  Â  Â  Â  if (selectedAddress) viewEmails(selectedAddress);
Â  Â  }, 10000);
}

// Custom Modal Functions
function showModal(title, message, confirmCallback) {
Â  Â  const modal = document.getElementById('custom-modal');
Â  Â  const modalTitle = document.getElementById('modal-title');
Â  Â  const modalMessage = document.getElementById('modal-message');
Â  Â  const modalConfirm = document.getElementById('modal-confirm');
Â  Â  const modalCancel = document.getElementById('modal-cancel');
Â  Â  
Â  Â  modalTitle.textContent = title;
Â  Â  modalMessage.textContent = message;
Â  Â  modal.classList.remove('hidden');
Â  Â  
Â  Â  // Remove previous event listeners
Â  Â  const newConfirm = modalConfirm.cloneNode(true);
Â  Â  const newCancel = modalCancel.cloneNode(true);
Â  Â  modalConfirm.parentNode.replaceChild(newConfirm, modalConfirm);
Â  Â  modalCancel.parentNode.replaceChild(newCancel, modalCancel);
Â  Â  
Â  Â  // Add new event listeners
Â  Â  document.getElementById('modal-confirm').onclick = function() {
Â  Â  Â  Â  modal.classList.add('hidden');
Â  Â  Â  Â  if (confirmCallback) confirmCallback();
Â  Â  };
Â  Â  
Â  Â  document.getElementById('modal-cancel').onclick = function() {
Â  Â  Â  Â  modal.classList.add('hidden');
Â  Â  };
}

// Login handler
document.getElementById('admin-login-btn').addEventListener('click', adminLogin);
document.getElementById('admin-password').addEventListener('keypress', function(e) {
Â  Â  if (e.key === 'Enter') adminLogin();
});

function adminLogin() {
Â  Â  var password = document.getElementById('admin-password').value;
Â  Â  var errorEl = document.getElementById('admin-login-error');
Â  Â  var btn = document.getElementById('admin-login-btn');
Â  Â  
Â  Â  if (!password) {
Â  Â  Â  Â  errorEl.textContent = 'âŒ Please enter password';
Â  Â  Â  Â  errorEl.style.display = 'block';
Â  Â  Â  Â  return;
Â  Â  }
Â  Â  
Â  Â  // Show loading state
Â  Â  btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Logging in...';
Â  Â  btn.disabled = true;
Â  Â  
Â  Â  fetch(API_URL + '/api/admin/login', {
Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  headers: {'Content-Type': 'application/json'},
Â  Â  Â  Â  body: JSON.stringify({password: password})
Â  Â  })
Â  Â  .then(res => {
Â  Â  Â  Â  if (!res.ok) {
Â  Â  Â  Â  Â  Â  throw new Error('Login failed');
Â  Â  Â  Â  }
Â  Â  Â  Â  return res.json();
Â  Â  })
Â  Â  .then(data => {
Â  Â  Â  Â  Â  Â  Â  Â  if (data.success) {
Â  Â  Â  Â  Â  Â  document.getElementById('login-screen').style.display = 'none';
Â  Â  Â  Â  Â  Â  document.getElementById('admin-dashboard').style.display = 'block';
Â  Â  Â  Â  Â  Â  loadStats();
Â  Â  Â  Â  Â  Â  loadAddresses();
Â  Â  Â  Â  Â  Â  loadActiveSessions();
Â  Â  Â  Â  Â  Â  loadBlacklist();
Â  Â  Â  Â  Â  Â  startAutoRefresh();
Â  Â  Â  Â  Â  Â  showNotification('âœ… Successfully logged in', 'success');
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  throw new Error('Invalid password');
Â  Â  Â  Â  }
Â  Â  })
Â  Â  .catch(err => {
Â  Â  Â  Â  errorEl.textContent = 'âŒ ' + (err.message || 'Login failed');
Â  Â  Â  Â  errorEl.style.display = 'block';
Â  Â  Â  Â  setTimeout(() => errorEl.style.display = 'none', 3000);
Â  Â  })
Â  Â  .finally(() => {
Â  Â  Â  Â  // Reset button state
Â  Â  Â  Â  btn.innerHTML = '<i class="fas fa-sign-in-alt mr-2"></i>Login';
Â  Â  Â  Â  btn.disabled = false;
Â  Â  });
}

// Logout handler
document.getElementById('logout-btn').addEventListener('click', function() {
Â  Â  showModal(
Â  Â  Â  Â  'Confirm Logout',
Â  Â  Â  Â  'Are you sure you want to logout from the admin panel?',
Â  Â  Â  Â  function() {
Â  Â  Â  Â  Â  Â  fetch(API_URL + '/api/admin/logout', {method: 'POST'})
Â  Â  Â  Â  Â  Â  .then(() => {
Â  Â  Â  Â  Â  Â  Â  Â  location.reload();
Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  .catch(() => {
Â  Â  Â  Â  Â  Â  Â  Â  location.reload();
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  );
});

// Load stats
function loadStats() {
Â  Â  fetch(API_URL + '/api/admin/stats')
Â  Â  .then(res => {
Â  Â  Â  Â  if (res.status === 401) {
Â  Â  Â  Â  Â  Â  location.reload();
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  return res.json();
Â  Â  })
Â  Â  .then(data => {
Â  Â  Â  Â  if (data && !data.error) {
Â  Â  Â  Â  Â  Â  document.getElementById('stat-emails').textContent = data.total_emails || 0;
Â  Â  Â  Â  Â  Â  document.getElementById('stat-addresses').textContent = data.total_addresses || 0;
Â  Â  Â  Â  Â  Â  document.getElementById('stat-recent').textContent = data.recent_emails || 0;
Â  Â  Â  Â  }
Â  Â  })
Â  Â  .catch(err => console.error('Error loading stats:', err));
}

// Load addresses
function loadAddresses() {
Â  Â  fetch(API_URL + '/api/admin/addresses')
Â  Â  .then(res => {
Â  Â  Â  Â  if (res.status === 401) {
Â  Â  Â  Â  Â  Â  location.reload();
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  return res.json();
Â  Â  })
Â  Â  .then(data => {
Â  Â  Â  Â  if (!data || data.error) {
Â  Â  Â  Â  Â  Â  document.getElementById('address-list').innerHTML = '<p class="text-red-400 text-center py-8">Error loading addresses</p>';
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  var list = document.getElementById('address-list');
Â  Â  Â  Â  list.innerHTML = '';
Â  Â  Â  Â  
Â  Â  Â  Â  if (!data.addresses || data.addresses.length === 0) {
Â  Â  Â  Â  Â  Â  list.innerHTML = '<p class="text-gray-400 text-center py-8">No email addresses yet</p>';
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  data.addresses.forEach(addr => {
Â  Â  Â  Â  Â  Â  var item = document.createElement('div');
Â  Â  Â  Â  Â  Â  item.className = 'address-item bg-gray-800 p-4 rounded-lg border border-gray-700 hover:border-gray-600';
Â  Â  Â  Â  Â  Â  item.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-between items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-white font-semibold truncate text-sm">${escapeHtml(addr.address)}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs text-gray-400 mt-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${addr.count || 0} email${(addr.count || 0) !== 1 ? 's' : ''} â€¢ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${formatTime(addr.last_email)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex gap-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="viewEmails('${escapeHtml(addr.address)}')" class="text-blue-400 hover:text-blue-300 p-2 rounded transition-colors" title="View emails">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-eye"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="deleteAddress('${escapeHtml(addr.address)}')" class="text-red-400 hover:text-red-300 p-2 rounded transition-colors" title="Delete all emails">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-trash"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  list.appendChild(item);
Â  Â  Â  Â  });
Â  Â  })
Â  Â  .catch(err => {
Â  Â  Â  Â  console.error('Error loading addresses:', err);
Â  Â  Â  Â  document.getElementById('address-list').innerHTML = '<p class="text-red-400 text-center py-8">Failed to load addresses</p>';
Â  Â  });
}

// View emails for address
function viewEmails(address) {
Â  Â  selectedAddress = address;
Â  Â  document.getElementById('selected-address').textContent = address;
Â  Â  
Â  Â  fetch(API_URL + '/api/admin/emails/' + encodeURIComponent(address))
Â  Â  .then(res => res.json())
Â  Â  .then(data => {
Â  Â  Â  Â  var details = document.getElementById('email-details');
Â  Â  Â  Â  var badge = document.getElementById('email-count-badge');
Â  Â  Â  Â  
Â  Â  Â  Â  if (!data || data.error) {
Â  Â  Â  Â  Â  Â  details.innerHTML = '<p class="text-red-400 text-center py-8">Error loading emails</p>';
Â  Â  Â  Â  Â  Â  badge.classList.add('hidden');
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  if (!data.emails || data.emails.length === 0) {
Â  Â  Â  Â  Â  Â  details.innerHTML = '<p class="text-gray-400 text-center py-8">No emails for this address</p>';
Â  Â  Â  Â  Â  Â  badge.textContent = '0 emails';
Â  Â  Â  Â  Â  Â  badge.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  // Update badge
Â  Â  Â  Â  badge.textContent = data.emails.length + ' email' + (data.emails.length !== 1 ? 's' : '');
Â  Â  Â  Â  badge.classList.remove('hidden');
Â  Â  Â  Â  
Â  Â  Â  Â  details.innerHTML = '';
Â  Â  Â  Â  
Â  Â  Â  Â  data.emails.forEach(email => {
Â  Â  Â  Â  Â  Â  var item = document.createElement('div');
Â  Â  Â  Â  Â  Â  item.className = 'bg-gray-800 p-4 rounded-lg border border-gray-700 hover:border-gray-600 transition-colors';
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Clean and truncate body for preview
Â  Â  Â  Â  Â  Â  var cleanBody = email.body ? email.body.replace(/<[^>]*>/g, '').replace(/\s+/g, ' ').trim() : 'No content';
Â  Â  Â  Â  Â  Â  var previewBody = cleanBody.length > 100 ? cleanBody.substring(0, 100) + '...' : cleanBody;
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  item.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-between items-start mb-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-white font-semibold text-sm truncate">${escapeHtml(email.sender || 'Unknown')}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-gray-300 text-sm font-medium mt-1">${escapeHtml(email.subject || 'No subject')}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs text-gray-400 mt-1">${formatTime(email.timestamp)}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="deleteEmail(${email.id})" class="text-red-400 hover:text-red-300 p-2 rounded transition-colors ml-2" title="Delete email">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-trash"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs text-gray-400 mt-2">${escapeHtml(previewBody)}</p>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  details.appendChild(item);
Â  Â  Â  Â  });
Â  Â  })
Â  Â  .catch(err => {
Â  Â  Â  Â  console.error('Error loading emails:', err);
Â  Â  Â  Â  document.getElementById('email-details').innerHTML = '<p class="text-red-400 text-center py-8">Failed to load emails</p>';
Â  Â  });
}

// Delete single email
function deleteEmail(emailId) {
Â  Â  showModal(
Â  Â  Â  Â  'Delete Email',
Â  Â  Â  Â  'Are you sure you want to delete this email? This action cannot be undone.',
Â  Â  Â  Â  function() {
Â  Â  Â  Â  Â  Â  fetch(API_URL + '/api/admin/delete/' + emailId, {method: 'DELETE'})
Â  Â  Â  Â  Â  Â  .then(res => res.json())
Â  Â  Â  Â  Â  Â  .then(data => {
Â  Â  Â  Â  Â  Â  Â  Â  if (data.success) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (selectedAddress) viewEmails(selectedAddress);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  loadStats();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showNotification('âœ… Email deleted successfully', 'success');
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showNotification('âŒ Failed to delete email', 'error');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  .catch(err => {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('Error deleting email:', err);
Â  Â  Â  Â  Â  Â  Â  Â  showNotification('âŒ Error deleting email', 'error');
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  );
}

// Delete all emails for address
function deleteAddress(address) {
Â  Â  showModal(
Â  Â  Â  Â  'Delete All Emails',
Â  Â  Â  Â  `Are you sure you want to delete ALL emails for <strong>${escapeHtml(address)}</strong>?<br><br>This action cannot be undone and will permanently remove all emails for this address.`,
Â  Â  Â  Â  function() {
Â  Â  Â  Â  Â  Â  fetch(API_URL + '/api/admin/delete-address/' + encodeURIComponent(address), {method: 'DELETE'})
Â  Â  Â  Â  Â  Â  .then(res => res.json())
Â  Â  Â  Â  Â  Â  .then(data => {
Â  Â  Â  Â  Â  Â  Â  Â  if (data.success) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  loadAddresses();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  loadStats();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('email-details').innerHTML = '<p class="text-gray-400 text-center py-8">Select an email address to view emails</p>';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('selected-address').textContent = 'None selected';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('email-count-badge').classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showNotification('âœ… All emails deleted for ' + address, 'success');
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showNotification('âŒ Failed to delete emails', 'error');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  .catch(err => {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('Error deleting address:', err);
Â  Â  Â  Â  Â  Â  Â  Â  showNotification('âŒ Error deleting emails', 'error');
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  );
}
Â  Â  

// Load active sessions (you'll need to add this endpoint to your backend)
function loadActiveSessions() {
Â  Â  // This is a placeholder - you'll need to implement this endpoint
Â  Â  var sessionsEl = document.getElementById('active-sessions');
Â  Â  sessionsEl.innerHTML = '<p class="text-gray-400 text-center py-8">Active sessions feature coming soon</p>';
}
// Load active sessions
function loadActiveSessions() {
Â  Â  fetch(API_URL + '/api/admin/sessions')
Â  Â  .then(res => {
Â  Â  Â  Â  if (res.status === 401) {
Â  Â  Â  Â  Â  Â  location.reload();
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  return res.json();
Â  Â  })
Â  Â  .then(data => {
Â  Â  Â  Â  var sessionsEl = document.getElementById('active-sessions');
Â  Â  Â  Â  
Â  Â  Â  Â  if (!data || data.error) {
Â  Â  Â  Â  Â  Â  sessionsEl.innerHTML = '<p class="text-red-400 text-center py-8">Error loading sessions</p>';
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  if (!data.sessions || data.sessions.length === 0) {
Â  Â  Â  Â  Â  Â  sessionsEl.innerHTML = '<p class="text-gray-400 text-center py-8">No active sessions</p>';
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  sessionsEl.innerHTML = '';
Â  Â  Â  Â  
Â  Â  Â  Â  data.sessions.forEach(session => {
Â  Â  Â  Â  Â  Â  var item = document.createElement('div');
Â  Â  Â  Â  Â  Â  item.className = 'address-item bg-gray-800 p-4 rounded-lg border border-gray-700 hover:border-gray-600';
Â  Â  Â  Â  Â  Â  item.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-between items-start">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-white font-semibold text-sm truncate">${escapeHtml(session.email)}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-2 gap-2 mt-2 text-xs text-gray-400">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-play-circle mr-1"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${session.session_age_minutes} min ago
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-clock mr-1"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${session.time_remaining_minutes} min left
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs text-gray-500 mt-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Last active: ${formatTime(session.last_activity)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  sessionsEl.appendChild(item);
Â  Â  Â  Â  });
Â  Â  })
Â  Â  .catch(err => {
Â  Â  Â  Â  console.error('Error loading sessions:', err);
Â  Â  Â  Â  document.getElementById('active-sessions').innerHTML = '<p class="text-red-400 text-center py-8">Failed to load sessions</p>';
Â  Â  });
}

// Utility functions
function escapeHtml(text) {
Â  Â  if (!text) return '';
Â  Â  var div = document.createElement('div');
Â  Â  div.textContent = text;
Â  Â  return div.innerHTML;
}

function formatTime(timestamp) {
Â  Â  if (!timestamp) return 'never';
Â  Â  
Â  Â  try {
Â  Â  Â  Â  var date;
Â  Â  Â  Â  if (typeof timestamp === 'string') {
Â  Â  Â  Â  Â  Â  date = new Date(timestamp);
Â  Â  Â  Â  } else if (timestamp instanceof Date) {
Â  Â  Â  Â  Â  Â  date = timestamp;
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  date = new Date(timestamp);
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  var now = new Date();
Â  Â  Â  Â  var diff = now - date;
Â  Â  Â  Â  var seconds = Math.floor(diff / 1000);
Â  Â  Â  Â  var minutes = Math.floor(seconds / 60);
Â  Â  Â  Â  var hours = Math.floor(minutes / 60);
Â  Â  Â  Â  var days = Math.floor(hours / 24);
Â  Â  Â  Â  
Â  Â  Â  Â  if (seconds < 10) return 'just now';
Â  Â  Â  Â  if (seconds < 60) return seconds + ' sec ago';
Â  Â  Â  Â  if (minutes < 60) return minutes + ' min ago';
Â  Â  Â  Â  if (hours < 24) return hours + ' hour ago';
Â  Â  Â  Â  if (days < 7) return days + ' day ago';
Â  Â  Â  Â  
Â  Â  Â  Â  return date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'});
Â  Â  } catch (e) {
Â  Â  Â  Â  return 'unknown';
Â  Â  }
}

function showNotification(message, type) {
Â  Â  var bgColor = type === 'success' ? 'bg-green-600' : 'bg-red-600';
Â  Â  var icon = type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle';
Â  Â  
Â  Â  var notification = document.createElement('div');
Â  Â  notification.className = `fixed top-4 right-4 ${bgColor} text-white px-6 py-3 rounded-lg shadow-lg z-50 fade-in flex items-center`;
Â  Â  notification.innerHTML = `<i class="fas ${icon} mr-2"></i>${message}`;
Â  Â  document.body.appendChild(notification);
Â  Â  
Â  Â  setTimeout(() => {
Â  Â  Â  Â  notification.classList.add('opacity-0');
Â  Â  Â  Â  notification.classList.add('transition-opacity');
Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  notification.remove();
Â  Â  Â  Â  }, 300);
Â  Â  }, 3000);
}

function startAutoRefresh() {
Â  Â  if (autoRefreshInterval) clearInterval(autoRefreshInterval);
Â  Â  autoRefreshInterval = setInterval(() => {
Â  Â  Â  Â  loadStats();
Â  Â  Â  Â  loadAddresses();
Â  Â  Â  Â  loadActiveSessions();
Â  Â  Â  Â  if (selectedAddress) viewEmails(selectedAddress);
Â  Â  }, 8000); // Refresh every 10 seconds
}
</script>
</body>
</html>
